<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AUDIT ANA - Capacités Non Intégrées</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #1a1a2e;
      color: #eee;
      line-height: 1.6;
      padding: 20px;
    }
    .container { max-width: 1400px; margin: 0 auto; }
    h1 {
      color: #00d4ff;
      text-align: center;
      padding: 30px;
      background: linear-gradient(135deg, #16213e 0%, #0f3460 100%);
      border-radius: 15px;
      margin-bottom: 30px;
    }
    h2 {
      color: #e94560;
      border-bottom: 2px solid #e94560;
      padding-bottom: 10px;
      margin: 30px 0 20px;
    }
    h3 { color: #00d4ff; margin: 20px 0 10px; }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .summary-card {
      background: #16213e;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      border-left: 4px solid;
    }
    .summary-card.critical { border-color: #e94560; }
    .summary-card.warning { border-color: #f39c12; }
    .summary-card.success { border-color: #2ecc71; }
    .summary-card .number { font-size: 3em; font-weight: bold; }
    .summary-card.critical .number { color: #e94560; }
    .summary-card.warning .number { color: #f39c12; }
    .summary-card.success .number { color: #2ecc71; }

    .section {
      background: #16213e;
      border-radius: 12px;
      padding: 25px;
      margin-bottom: 25px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #0f3460;
    }
    th {
      background: #0f3460;
      color: #00d4ff;
      font-weight: 600;
    }
    tr:hover { background: rgba(0, 212, 255, 0.1); }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: 600;
    }
    .status-critical { background: #e94560; color: white; }
    .status-high { background: #f39c12; color: black; }
    .status-medium { background: #3498db; color: white; }
    .status-low { background: #2ecc71; color: white; }
    .status-ok { background: #27ae60; color: white; }
    .status-partial { background: #9b59b6; color: white; }

    .issue-card {
      background: #0f3460;
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
      border-left: 4px solid;
    }
    .issue-card.critical { border-color: #e94560; }
    .issue-card.high { border-color: #f39c12; }
    .issue-card.medium { border-color: #3498db; }

    .issue-card h4 { color: #00d4ff; margin-bottom: 10px; }
    .issue-card p { margin: 5px 0; color: #bbb; }
    .issue-card code {
      background: #1a1a2e;
      padding: 2px 8px;
      border-radius: 4px;
      color: #2ecc71;
    }

    .recommendation {
      background: rgba(46, 204, 113, 0.1);
      border: 1px solid #2ecc71;
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
    }
    .recommendation h4 { color: #2ecc71; }

    .file-path {
      font-family: 'Consolas', monospace;
      background: #1a1a2e;
      padding: 3px 8px;
      border-radius: 4px;
      color: #f39c12;
    }

    footer {
      text-align: center;
      padding: 30px;
      color: #666;
      border-top: 1px solid #0f3460;
      margin-top: 40px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>AUDIT ANA SUPERIA<br><small style="font-size: 0.5em; color: #888;">Capacités Existantes Non Intégrées</small></h1>

    <!-- RÉSUMÉ -->
    <div class="summary-grid">
      <div class="summary-card critical">
        <div class="number">9</div>
        <div>Modules Backend<br>Non Intégrés</div>
      </div>
      <div class="summary-card critical">
        <div class="number">5</div>
        <div>Issues Critiques<br>Frontend</div>
      </div>
      <div class="summary-card warning">
        <div class="number">6</div>
        <div>Endpoints API<br>Manquants</div>
      </div>
      <div class="summary-card success">
        <div class="number">19</div>
        <div>Modules<br>Fonctionnels</div>
      </div>
    </div>

    <!-- CORRECTIONS RÉCENTES -->
    <div class="section" style="background: rgba(46, 204, 113, 0.1); border: 2px solid #2ecc71;">
      <h3 style="color: #2ecc71;">✅ CORRIGÉ LE 29 NOVEMBRE 2025</h3>
      <ul style="margin-left: 20px; color: #2ecc71;">
        <li><strong>ComfyUI:</strong> CORS fix (--enable-cors-header "*") + path corrigé (E:\AI_Tools\ComfyUI)</li>
        <li><strong>n8nPage:</strong> Proxy Express ajouté (/api/n8n → localhost:5678) avec X-N8N-API-KEY</li>
        <li><strong>n8nPage:</strong> Component name fix (n8nPage → N8nPage) pour React</li>
        <li><strong>n8nPage:</strong> ServiceManager détecte n8n externe (checkPortInUse)</li>
        <li><strong>n8nPage:</strong> Bouton "Ouvrir n8n Editor" → localhost:5678 direct</li>
      </ul>
    </div>

    <!-- SECTION 1: BACKEND NON INTÉGRÉ -->
    <h2>1. BACKEND - Modules Non Intégrés</h2>

    <div class="section">
      <h3>IMPACT ÉLEVÉ - À intégrer en priorité</h3>

      <div class="issue-card critical">
        <h4>fooocus-integration.cjs</h4>
        <p><strong>Chemin:</strong> <span class="file-path">E:/ANA/server/services/fooocus-integration.cjs</span></p>
        <p><strong>Description:</strong> Service COMPLET de génération d'images SDXL optimisé RTX 3070</p>
        <p><strong>Capacités inutilisées:</strong></p>
        <ul style="margin-left: 20px; color: #bbb;">
          <li>start() - Lancer Fooocus</li>
          <li>generate(prompt, preset) - Générer images</li>
          <li>6 presets: default, lightning, anime, realistic, portrait, landscape</li>
          <li>10 styles intégrés</li>
          <li>Queue de génération avec timeout</li>
        </ul>
        <p><strong>Problème:</strong> <span class="status-badge status-critical">Aucun endpoint API créé</span></p>
      </div>

      <div class="issue-card critical">
        <h4>semantic-router.cjs</h4>
        <p><strong>Chemin:</strong> <span class="file-path">E:/ANA/server/intelligence/semantic-router.cjs</span></p>
        <p><strong>Description:</strong> Routeur intelligent qui choisit le LLM optimal selon le type de tâche</p>
        <p><strong>Capacités inutilisées:</strong></p>
        <ul style="margin-left: 20px; color: #bbb;">
          <li>classify(query) - Classification sémantique</li>
          <li>route(query) - Routing vers LLM optimal</li>
          <li>8 task types: CODING, MATH, VISION, WRITING, ANALYSIS, CONVERSATION, CREATIVE, RESEARCH</li>
        </ul>
        <p><strong>Problème:</strong> <span class="status-badge status-critical">Jamais importé dans ana-core.cjs</span></p>
      </div>

      <div class="issue-card critical">
        <h4>context-selector.cjs</h4>
        <p><strong>Chemin:</strong> <span class="file-path">E:/ANA/server/intelligence/context-selector.cjs</span></p>
        <p><strong>Description:</strong> Sélection intelligente du contexte pour RAG/LLM</p>
        <p><strong>Capacités inutilisées:</strong></p>
        <ul style="margin-left: 20px; color: #bbb;">
          <li>selectContext(query, sources, budget) - Sélection optimale</li>
          <li>Scoring sémantique</li>
          <li>Gestion budget tokens</li>
          <li>Pondération recency + diversité</li>
        </ul>
        <p><strong>Problème:</strong> <span class="status-badge status-critical">Jamais appelé nulle part</span></p>
      </div>
    </div>

    <div class="section">
      <h3>IMPACT MOYEN - Partiellement intégrés</h3>

      <div class="issue-card medium">
        <h4>tiered-memory.cjs</h4>
        <p><strong>Chemin:</strong> <span class="file-path">E:/ANA/server/memory/tiered-memory.cjs</span></p>
        <p><strong>Description:</strong> Architecture mémoire 3 niveaux (Primary/Secondary/Tertiary)</p>
        <p><strong>Endpoints créés:</strong> 5 endpoints API existent</p>
        <p><strong>Problème:</strong> <span class="status-badge status-medium">Endpoints jamais appelés par les agents</span></p>
      </div>

      <div class="issue-card medium">
        <h4>skill-learner.cjs</h4>
        <p><strong>Chemin:</strong> <span class="file-path">E:/ANA/server/intelligence/skill-learner.cjs</span></p>
        <p><strong>Description:</strong> Système de meta-learning pour amélioration continue</p>
        <p><strong>Endpoints créés:</strong> 7 endpoints API existent</p>
        <p><strong>Problème:</strong> <span class="status-badge status-medium">Endpoints jamais appelés dans workflows</span></p>
      </div>
    </div>

    <!-- SECTION 2: FRONTEND NON CONNECTÉ -->
    <h2>2. FRONTEND - Pages Non Connectées</h2>

    <div class="section">
      <h3>CRITIQUES - Fonctionnalités cassées</h3>

      <div class="issue-card critical">
        <h4>CodingPage - Agent Execution Broken</h4>
        <p><strong>Fichier:</strong> <span class="file-path">CodingPage.jsx</span></p>
        <p><strong>Problème:</strong> L'agent coding envoie <code>socket.emit('coding:run')</code> mais n'écoute AUCUNE réponse</p>
        <p><strong>States inutilisés:</strong> agentStatus, agentActions, agentResult, showAgentPanel</p>
        <p><strong>Impact:</strong> <span class="status-badge status-critical">L'utilisateur voit "running" indéfiniment</span></p>
        <p><strong>Fix requis:</strong> Ajouter listeners pour coding:started, coding:action, coding:completed, coding:error</p>
      </div>

      <div class="issue-card critical">
        <h4>CodingPage - Terminal Non Fonctionnel</h4>
        <p><strong>Fichier:</strong> <span class="file-path">CodingPage.jsx ligne 283</span></p>
        <p><strong>Problème:</strong> handleExecuteCode() n'appelle aucun endpoint backend</p>
        <p><strong>Impact:</strong> <span class="status-badge status-critical">Le bouton Execute ne fait rien</span></p>
        <p><strong>Endpoint manquant:</strong> <code>/api/code/execute</code></p>
      </div>

      <div class="issue-card critical">
        <h4>LogsPage - Logs Fabriqués</h4>
        <p><strong>Fichier:</strong> <span class="file-path">LogsPage.jsx</span></p>
        <p><strong>Problème:</strong> Les logs sont générés à partir de /api/stats, pas de vrais logs système</p>
        <p><strong>Impact:</strong> <span class="status-badge status-critical">Impossible de débugger le système</span></p>
        <p><strong>Endpoint manquant:</strong> <code>/api/logs</code> ou <code>/api/system/logs</code></p>
      </div>

      <div class="issue-card critical">
        <h4>VoicePage - Conversations Non Sauvegardées</h4>
        <p><strong>Fichier:</strong> <span class="file-path">VoicePage.jsx</span></p>
        <p><strong>Problème:</strong> Les conversations vocales sont perdues au refresh</p>
        <p><strong>Impact:</strong> <span class="status-badge status-critical">Mémoire vocale perdue</span></p>
        <p><strong>Endpoint manquant:</strong> <code>POST /api/memory/save-conversation</code></p>
      </div>

      <div class="issue-card critical">
        <h4>SettingsPage - Pas de Sync Backend</h4>
        <p><strong>Fichier:</strong> <span class="file-path">SettingsPage.jsx</span></p>
        <p><strong>Problème:</strong> Settings sauvegardés uniquement en localStorage</p>
        <p><strong>Impact:</strong> <span class="status-badge status-critical">Settings perdus entre appareils</span></p>
        <p><strong>Endpoint manquant:</strong> <code>POST /api/user/settings</code></p>
      </div>
    </div>

    <div class="section">
      <h3>MOYENS - Fonctionnalités incomplètes</h3>

      <table>
        <thead>
          <tr>
            <th>Page</th>
            <th>Problème</th>
            <th>Impact</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>n8nPage</td>
            <td>Boutons "Installer template" sans onClick</td>
            <td><span class="status-badge status-high">Dead UI</span> <span class="status-badge status-partial">Future feature</span></td>
          </tr>
          <tr>
            <td>n8nPage</td>
            <td><s>Page ne se chargeait pas</s> → Proxy n8n + Component name fix</td>
            <td><span class="status-badge status-ok">CORRIGÉ 29/11</span></td>
          </tr>
          <tr>
            <td>n8nPage</td>
            <td><s>Bouton Editor ouvrait page blanche</s> → URL directe localhost:5678</td>
            <td><span class="status-badge status-ok">CORRIGÉ 29/11</span></td>
          </tr>
          <tr>
            <td>DashboardPage</td>
            <td>/api/agents et /api/events possiblement manquants</td>
            <td><span class="status-badge status-medium">Fallback silencieux</span></td>
          </tr>
          <tr>
            <td>VoicePage</td>
            <td>Sélection modèle non confirmée par backend</td>
            <td><span class="status-badge status-medium">Incertain</span></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- SECTION 3: ENDPOINTS MANQUANTS -->
    <h2>3. ENDPOINTS API MANQUANTS</h2>

    <div class="section">
      <table>
        <thead>
          <tr>
            <th>Endpoint</th>
            <th>Requis par</th>
            <th>Priorité</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>/api/code/execute</code></td>
            <td>CodingPage.jsx</td>
            <td><span class="status-badge status-critical">CRITIQUE</span></td>
          </tr>
          <tr>
            <td><code>/api/logs</code></td>
            <td>LogsPage.jsx</td>
            <td><span class="status-badge status-critical">CRITIQUE</span></td>
          </tr>
          <tr>
            <td><code>/api/memory/save-conversation</code></td>
            <td>VoicePage.jsx</td>
            <td><span class="status-badge status-critical">CRITIQUE</span></td>
          </tr>
          <tr>
            <td><code>/api/user/settings</code></td>
            <td>SettingsPage.jsx</td>
            <td><span class="status-badge status-high">HAUTE</span></td>
          </tr>
          <tr>
            <td><code>/api/fooocus/*</code></td>
            <td>fooocus-integration.cjs</td>
            <td><span class="status-badge status-high">HAUTE</span></td>
          </tr>
          <tr>
            <td><code>/api/n8n/templates/install</code></td>
            <td>n8nPage.jsx</td>
            <td><span class="status-badge status-medium">MOYENNE</span></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- SECTION 4: WEBSOCKET EVENTS MANQUANTS -->
    <h2>4. WEBSOCKET EVENTS - CodingPage</h2>

    <div class="section">
      <p style="color: #e94560; font-weight: bold;">Le frontend envoie <code>coding:run</code> mais n'écoute pas les réponses!</p>

      <table>
        <thead>
          <tr>
            <th>Event</th>
            <th>Direction</th>
            <th>Statut</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>coding:run</code></td>
            <td>Frontend → Backend</td>
            <td><span class="status-badge status-ok">Envoyé</span></td>
          </tr>
          <tr>
            <td><code>coding:started</code></td>
            <td>Backend → Frontend</td>
            <td><span class="status-badge status-critical">PAS ÉCOUTÉ</span></td>
          </tr>
          <tr>
            <td><code>coding:action</code></td>
            <td>Backend → Frontend</td>
            <td><span class="status-badge status-critical">PAS ÉCOUTÉ</span></td>
          </tr>
          <tr>
            <td><code>coding:completed</code></td>
            <td>Backend → Frontend</td>
            <td><span class="status-badge status-critical">PAS ÉCOUTÉ</span></td>
          </tr>
          <tr>
            <td><code>coding:error</code></td>
            <td>Backend → Frontend</td>
            <td><span class="status-badge status-critical">PAS ÉCOUTÉ</span></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- SECTION 5: RECOMMANDATIONS -->
    <h2>5. PLAN D'ACTION RECOMMANDÉ</h2>

    <div class="section">
      <div class="recommendation">
        <h4>PRIORITÉ 1 - Quick Wins (1-2 jours)</h4>
        <ol style="margin-left: 20px;">
          <li>Connecter CodingPage aux events WebSocket (coding:started, coding:action, coding:completed, coding:error)</li>
          <li>Intégrer semantic-router.cjs dans /api/chat pour routing automatique</li>
          <li>Intégrer context-selector.cjs pour optimisation RAG</li>
        </ol>
      </div>

      <div class="recommendation">
        <h4>PRIORITÉ 2 - Endpoints manquants (2-3 jours)</h4>
        <ol style="margin-left: 20px;">
          <li>Créer /api/code/execute pour terminal CodingPage</li>
          <li>Créer /api/logs pour vrais logs système</li>
          <li>Créer /api/memory/save-conversation pour VoicePage</li>
          <li>Exposer fooocus-integration via /api/fooocus/*</li>
        </ol>
      </div>

      <div class="recommendation">
        <h4>PRIORITÉ 3 - Intégration profonde (1 semaine)</h4>
        <ol style="margin-left: 20px;">
          <li>Faire tiered-memory la mémoire primaire</li>
          <li>Intégrer skill-learner dans boucle feedback agents</li>
          <li>Créer service unifié d'images (daily-art + fooocus)</li>
        </ol>
      </div>
    </div>

    <footer>
      <p>Audit généré le 28 Novembre 2025 par Claude</p>
      <p>Ana SUPERIA - "Il n'y a rien de magique. Rien de mystérieux. Que des évidences. Il suffit de savoir."</p>
    </footer>
  </div>
</body>
</html>
