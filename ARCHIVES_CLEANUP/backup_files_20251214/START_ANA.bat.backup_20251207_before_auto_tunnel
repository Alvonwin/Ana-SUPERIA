@echo off
chcp 65001 >nul
title ðŸ¤– DÃ©marrage ANA - SUPERIA
color 0B

echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘                                                           â•‘
echo â•‘            ðŸ¤– DÃ‰MARRAGE ANA - SUPERIA IA ðŸ¤–              â•‘
echo â•‘                                                           â•‘
echo â•‘         100%% Local â€¢ $0 â€¢ MÃ©moire Infinie                â•‘
echo â•‘                                                           â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

REM Aller dans le dossier ANA
cd /d "E:\ANA"

REM LibÃ©rer les ports critiques (3338 et 5173)
echo ðŸ§¹ Nettoyage des ports critiques...
for /f "tokens=5" %%a in ('netstat -ano 2^>nul ^| findstr ":3338" ^| findstr "LISTENING"') do (
    taskkill /F /PID %%a >nul 2>&1
)
for /f "tokens=5" %%a in ('netstat -ano 2^>nul ^| findstr ":5173" ^| findstr "LISTENING"') do (
    taskkill /F /PID %%a >nul 2>&1
)
echo âœ… Ports 3338 et 5173 libÃ©rÃ©s
echo.

REM RÃ©initialiser errorlevel
cmd /c "exit /b 0"

REM VÃ©rifier si Node.js est installÃ©
where node >nul 2>&1
if %errorlevel% neq 0 (
    echo âŒ ERREUR: Node.js n'est pas installÃ©!
    echo    TÃ©lÃ©charge Node.js depuis: https://nodejs.org
    pause
    exit /b 1
)

REM VÃ©rifier si le dossier server existe
if not exist "E:\ANA\server" (
    echo âŒ ERREUR: Le dossier E:\ANA\server n'existe pas!
    pause
    exit /b 1
)

REM LibÃ©rer le port ChromaDB
for /f "tokens=5" %%a in ('netstat -ano 2^>nul ^| findstr ":8000" ^| findstr "LISTENING"') do (
    taskkill /F /PID %%a >nul 2>&1
)

REM DÃ©marrer ChromaDB (mÃ©moire vectorielle)
echo [1/3] ðŸ’¾ DÃ©marrage ChromaDB (port 8000)...
start "ChromaDB Server" /MIN cmd /c ""C:\Users\niwno\AppData\Local\Programs\Python\Python310\Scripts\chroma.exe" run --path "E:\ANA\server\memory\chroma_data" --host localhost --port 8000"
echo    Attente de ChromaDB...
timeout /t 3 /nobreak >nul

REM DÃ©marrer le backend (ports dÃ©jÃ  nettoyÃ©s plus haut)
echo [2/3] ðŸš€ DÃ©marrage Ana Core Backend (port 3338)...
start "Ana Core Backend" cmd /c "cd /d E:\ANA\server && node ana-core.cjs"
echo    Attente du backend...
timeout /t 5 /nobreak >nul

echo [3/4] ðŸŒ DÃ©marrage Interface React (port 5173)...
start "Ana Interface Frontend" cmd /c "cd /d E:\ANA\ana-interface && npm run dev"

echo [4/4] ðŸ¤– DÃ©marrage Agents Autonomes (port 3336)...
start "Ana Agents Autonomes" cmd /c "cd /d E:\ANA\agents && node start_agents.cjs"

echo.
echo âœ… ANA est en cours de dÃ©marrage!
echo.
echo ðŸ’¾ ChromaDB (mÃ©moire):   http://localhost:8000
echo ðŸ“¡ Backend Ana Core:     http://localhost:3338
echo ðŸŒ Interface Ana:        http://localhost:5173
echo ðŸ¤– Agents Dashboard:     http://localhost:3336
echo.
echo â±ï¸  Attendre ~15 secondes que tout dÃ©marre...
echo.
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo ðŸ’¡ CONSEIL: Garde cette fenÃªtre ouverte pour voir les logs.
echo âŒ Pour arrÃªter Ana: Ferme les 3 fenÃªtres noires qui se sont ouvertes.
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo.

REM Attendre 15 secondes puis ouvrir le navigateur
timeout /t 15 /nobreak
echo ðŸŒ Ouverture de l'interface Ana dans le navigateur...
start http://localhost:5173

echo.
echo âœ¨ ANA est maintenant ACTIVE! âœ¨
echo.

REM DÃ©marrage des tunnels Cloudflare pour accÃ¨s distant
echo [5/5] ðŸŒ DÃ©marrage Tunnels Cloudflare (accÃ¨s distant)...
start "Cloudflare Frontend" /MIN cmd /c "\"C:\Program Files (x86)\cloudflared\cloudflared.exe\" tunnel --url http://localhost:5173"
start "Cloudflare Backend" /MIN cmd /c "\"C:\Program Files (x86)\cloudflared\cloudflared.exe\" tunnel --url http://localhost:3338"
echo    Les URLs distantes s'affichent dans les fenÃªtres Cloudflare.
echo.

echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo   Cette fenÃªtre va se fermer dans 5 secondes...
echo   Pour arrÃªter Ana: Settings ^> Fermer Ana
echo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
timeout /t 5 /nobreak >nul
exit
