{
  "category": "trpc-typescript-rpc",
  "version": "1.0.0",
  "generatedBy": "Claude (Opus 4.5)",
  "description": "tRPC TypeScript RPC patterns",
  "skills": [
    {"id": "trc01", "type": "setup", "name": "Install tRPC", "description": "NPM install", "pattern": "npm install @trpc/server @trpc/client @trpc/react-query @tanstack/react-query zod", "example": "Install"},
    {"id": "trc02", "type": "init", "name": "Initialize tRPC", "description": "Create tRPC instance", "pattern": "import { initTRPC } from '@trpc/server';\nimport { z } from 'zod';\n\nconst t = initTRPC.create();\n\nexport const router = t.router;\nexport const publicProcedure = t.procedure;", "example": "Init"},
    {"id": "trc03", "type": "router", "name": "Create Router", "description": "Define procedures", "pattern": "import { router, publicProcedure } from './trpc';\n\nexport const appRouter = router({\n  hello: publicProcedure\n    .input(z.object({ name: z.string() }))\n    .query(({ input }) => {\n      return { greeting: `Hello ${input.name}` };\n    })\n});\n\nexport type AppRouter = typeof appRouter;", "example": "Router"},
    {"id": "trc04", "type": "query", "name": "Query Procedure", "description": "Read data", "pattern": "const appRouter = router({\n  getUser: publicProcedure\n    .input(z.object({ id: z.string() }))\n    .query(async ({ input }) => {\n      const user = await db.user.findUnique({\n        where: { id: input.id }\n      });\n      return user;\n    }),\n  \n  getAllUsers: publicProcedure\n    .query(async () => {\n      return await db.user.findMany();\n    })\n});", "example": "Query"},
    {"id": "trc05", "type": "mutation", "name": "Mutation Procedure", "description": "Write data", "pattern": "const appRouter = router({\n  createUser: publicProcedure\n    .input(z.object({\n      name: z.string().min(1),\n      email: z.string().email()\n    }))\n    .mutation(async ({ input }) => {\n      const user = await db.user.create({\n        data: input\n      });\n      return user;\n    })\n});", "example": "Mutation"},
    {"id": "trc06", "type": "context", "name": "Context", "description": "Request context", "pattern": "import { CreateNextContextOptions } from '@trpc/server/adapters/next';\n\nexport const createContext = async ({ req, res }: CreateNextContextOptions) => {\n  const session = await getSession({ req });\n  return {\n    session,\n    db,\n    req,\n    res\n  };\n};\n\nexport type Context = Awaited<ReturnType<typeof createContext>>;\n\nconst t = initTRPC.context<Context>().create();", "example": "Context"},
    {"id": "trc07", "type": "middleware", "name": "Middleware", "description": "Auth middleware", "pattern": "const isAuthed = t.middleware(({ ctx, next }) => {\n  if (!ctx.session?.user) {\n    throw new TRPCError({ code: 'UNAUTHORIZED' });\n  }\n  return next({\n    ctx: {\n      ...ctx,\n      user: ctx.session.user\n    }\n  });\n});\n\nexport const protectedProcedure = t.procedure.use(isAuthed);", "example": "Middleware"},
    {"id": "trc08", "type": "nextjs", "name": "Next.js Integration", "description": "API handler", "pattern": "// pages/api/trpc/[trpc].ts\nimport { createNextApiHandler } from '@trpc/server/adapters/next';\nimport { appRouter } from '../../../server/routers/_app';\nimport { createContext } from '../../../server/context';\n\nexport default createNextApiHandler({\n  router: appRouter,\n  createContext\n});", "example": "Next.js"},
    {"id": "trc09", "type": "client", "name": "React Client", "description": "Setup client", "pattern": "import { createTRPCReact } from '@trpc/react-query';\nimport type { AppRouter } from '../server/routers/_app';\n\nexport const trpc = createTRPCReact<AppRouter>();\n\n// In _app.tsx\nimport { trpc } from '../utils/trpc';\n\nfunction App({ Component, pageProps }) {\n  return <Component {...pageProps} />;\n}\n\nexport default trpc.withTRPC(App);", "example": "Client"},
    {"id": "trc10", "type": "useQuery", "name": "useQuery", "description": "Query hook", "pattern": "import { trpc } from '../utils/trpc';\n\nfunction UserProfile({ userId }) {\n  const { data, isLoading, error } = trpc.getUser.useQuery({ id: userId });\n  \n  if (isLoading) return <Loading />;\n  if (error) return <Error message={error.message} />;\n  \n  return <div>{data.name}</div>;\n}", "example": "useQuery"},
    {"id": "trc11", "type": "useMutation", "name": "useMutation", "description": "Mutation hook", "pattern": "function CreateUser() {\n  const utils = trpc.useUtils();\n  \n  const createUser = trpc.createUser.useMutation({\n    onSuccess: () => {\n      utils.getAllUsers.invalidate();\n    }\n  });\n  \n  const handleSubmit = (data) => {\n    createUser.mutate(data);\n  };\n  \n  return <form onSubmit={handleSubmit}>...</form>;\n}", "example": "useMutation"},
    {"id": "trc12", "type": "subscription", "name": "Subscription", "description": "Real-time updates", "pattern": "import { observable } from '@trpc/server/observable';\n\nconst appRouter = router({\n  onMessage: publicProcedure.subscription(() => {\n    return observable<Message>((emit) => {\n      const onMessage = (data: Message) => {\n        emit.next(data);\n      };\n      \n      eventEmitter.on('message', onMessage);\n      \n      return () => {\n        eventEmitter.off('message', onMessage);\n      };\n    });\n  })\n});", "example": "Subscription"},
    {"id": "trc13", "type": "error", "name": "Error Handling", "description": "Custom errors", "pattern": "import { TRPCError } from '@trpc/server';\n\nconst appRouter = router({\n  getUser: publicProcedure\n    .input(z.object({ id: z.string() }))\n    .query(async ({ input }) => {\n      const user = await db.user.findUnique({ where: { id: input.id } });\n      \n      if (!user) {\n        throw new TRPCError({\n          code: 'NOT_FOUND',\n          message: 'User not found'\n        });\n      }\n      \n      return user;\n    })\n});", "example": "Error"},
    {"id": "trc14", "type": "merge", "name": "Merge Routers", "description": "Combine routers", "pattern": "const userRouter = router({\n  getUser: publicProcedure.query(() => {}),\n  createUser: publicProcedure.mutation(() => {})\n});\n\nconst postRouter = router({\n  getPosts: publicProcedure.query(() => {})\n});\n\nconst appRouter = router({\n  user: userRouter,\n  post: postRouter\n});\n\n// Client: trpc.user.getUser.useQuery()", "example": "Merge"},
    {"id": "trc15", "type": "output", "name": "Output Validation", "description": "Validate output", "pattern": "const appRouter = router({\n  getUser: publicProcedure\n    .input(z.object({ id: z.string() }))\n    .output(z.object({\n      id: z.string(),\n      name: z.string(),\n      email: z.string().email()\n    }))\n    .query(async ({ input }) => {\n      const user = await db.user.findUnique({ where: { id: input.id } });\n      return user;  // Validated against output schema\n    })\n});", "example": "Output"},
    {"id": "trc16", "type": "transformer", "name": "Transformer", "description": "Data serialization", "pattern": "import superjson from 'superjson';\n\nconst t = initTRPC.create({\n  transformer: superjson\n});\n\n// Supports Date, Map, Set, BigInt, etc.\nconst appRouter = router({\n  getData: publicProcedure.query(() => {\n    return {\n      date: new Date(),\n      map: new Map([['key', 'value']]),\n      set: new Set([1, 2, 3])\n    };\n  })\n});", "example": "Transformer"},
    {"id": "trc17", "type": "batch", "name": "Request Batching", "description": "Batch requests", "pattern": "// Client config\nimport { httpBatchLink } from '@trpc/client';\n\nconst client = trpc.createClient({\n  links: [\n    httpBatchLink({\n      url: '/api/trpc',\n      maxURLLength: 2083  // Batch up to URL limit\n    })\n  ]\n});\n\n// Multiple queries batched automatically\nconst user = trpc.getUser.useQuery({ id: '1' });\nconst posts = trpc.getPosts.useQuery();", "example": "Batch"},
    {"id": "trc18", "type": "ssr", "name": "SSR/SSG", "description": "Server-side rendering", "pattern": "import { createServerSideHelpers } from '@trpc/react-query/server';\n\nexport async function getServerSideProps() {\n  const helpers = createServerSideHelpers({\n    router: appRouter,\n    ctx: {}\n  });\n  \n  await helpers.getUser.prefetch({ id: '1' });\n  \n  return {\n    props: {\n      trpcState: helpers.dehydrate()\n    }\n  };\n}", "example": "SSR"},
    {"id": "trc19", "type": "infinite", "name": "Infinite Query", "description": "Pagination", "pattern": "const appRouter = router({\n  getPosts: publicProcedure\n    .input(z.object({\n      limit: z.number().min(1).max(100),\n      cursor: z.string().nullish()\n    }))\n    .query(async ({ input }) => {\n      const posts = await db.post.findMany({\n        take: input.limit + 1,\n        cursor: input.cursor ? { id: input.cursor } : undefined\n      });\n      \n      let nextCursor: string | undefined;\n      if (posts.length > input.limit) {\n        const nextItem = posts.pop();\n        nextCursor = nextItem.id;\n      }\n      \n      return { posts, nextCursor };\n    })\n});\n\n// Client\nconst { data, fetchNextPage } = trpc.getPosts.useInfiniteQuery(\n  { limit: 10 },\n  { getNextPageParam: (lastPage) => lastPage.nextCursor }\n);", "example": "Infinite"},
    {"id": "trc20", "type": "optimistic", "name": "Optimistic Updates", "description": "Instant UI", "pattern": "const utils = trpc.useUtils();\n\nconst createPost = trpc.createPost.useMutation({\n  onMutate: async (newPost) => {\n    await utils.getPosts.cancel();\n    const previousPosts = utils.getPosts.getData();\n    \n    utils.getPosts.setData(undefined, (old) => [\n      ...old,\n      { id: 'temp', ...newPost }\n    ]);\n    \n    return { previousPosts };\n  },\n  onError: (err, newPost, context) => {\n    utils.getPosts.setData(undefined, context.previousPosts);\n  },\n  onSettled: () => {\n    utils.getPosts.invalidate();\n  }\n});", "example": "Optimistic"},
    {"id": "trc21", "type": "prefetch", "name": "Prefetch", "description": "Prefetch data", "pattern": "function PostList() {\n  const utils = trpc.useUtils();\n  const posts = trpc.getPosts.useQuery();\n  \n  return posts.data?.map(post => (\n    <Link\n      key={post.id}\n      href={`/post/${post.id}`}\n      onMouseEnter={() => {\n        utils.getPost.prefetch({ id: post.id });\n      }}\n    >\n      {post.title}\n    </Link>\n  ));\n}", "example": "Prefetch"},
    {"id": "trc22", "type": "express", "name": "Express Adapter", "description": "Express integration", "pattern": "import express from 'express';\nimport { createExpressMiddleware } from '@trpc/server/adapters/express';\n\nconst app = express();\n\napp.use('/trpc',\n  createExpressMiddleware({\n    router: appRouter,\n    createContext\n  })\n);\n\napp.listen(3000);", "example": "Express"},
    {"id": "trc23", "type": "standalone", "name": "Standalone Server", "description": "HTTP server", "pattern": "import { createHTTPServer } from '@trpc/server/adapters/standalone';\n\nconst server = createHTTPServer({\n  router: appRouter,\n  createContext\n});\n\nserver.listen(3000);", "example": "Standalone"},
    {"id": "trc24", "type": "wsAdapter", "name": "WebSocket Adapter", "description": "WS subscriptions", "pattern": "import { applyWSSHandler } from '@trpc/server/adapters/ws';\nimport ws from 'ws';\n\nconst wss = new ws.Server({ port: 3001 });\n\napplyWSSHandler({\n  wss,\n  router: appRouter,\n  createContext\n});\n\nconsole.log('WebSocket server listening on ws://localhost:3001');", "example": "WS"},
    {"id": "trc25", "type": "headers", "name": "Custom Headers", "description": "Auth headers", "pattern": "import { httpBatchLink } from '@trpc/client';\n\nconst client = trpc.createClient({\n  links: [\n    httpBatchLink({\n      url: '/api/trpc',\n      headers() {\n        return {\n          authorization: getAuthToken()\n        };\n      }\n    })\n  ]\n});", "example": "Headers"},
    {"id": "trc26", "type": "file", "name": "File Uploads", "description": "Upload files", "pattern": "// Use formidable or multer for file handling\nconst appRouter = router({\n  uploadFile: publicProcedure\n    .input(z.object({\n      filename: z.string(),\n      data: z.string()  // Base64\n    }))\n    .mutation(async ({ input }) => {\n      const buffer = Buffer.from(input.data, 'base64');\n      await fs.writeFile(`uploads/${input.filename}`, buffer);\n      return { success: true };\n    })\n});", "example": "Upload"},
    {"id": "trc27", "type": "testing", "name": "Testing", "description": "Test procedures", "pattern": "import { createTRPCMsw } from 'msw-trpc';\nimport type { AppRouter } from '../server/routers/_app';\n\nexport const trpcMsw = createTRPCMsw<AppRouter>();\n\nconst handlers = [\n  trpcMsw.getUser.query(() => ({\n    id: '1',\n    name: 'Test User'\n  }))\n];\n\n// Or direct testing\nconst caller = appRouter.createCaller({ db, session: null });\nconst result = await caller.getUser({ id: '1' });", "example": "Testing"},
    {"id": "trc28", "type": "zod", "name": "Zod Schemas", "description": "Validation schemas", "pattern": "const UserInput = z.object({\n  name: z.string().min(1, 'Name is required'),\n  email: z.string().email('Invalid email'),\n  age: z.number().min(18, 'Must be 18+').optional(),\n  role: z.enum(['user', 'admin']).default('user')\n});\n\nconst appRouter = router({\n  createUser: publicProcedure\n    .input(UserInput)\n    .mutation(({ input }) => {\n      // input is fully typed!\n      return db.user.create({ data: input });\n    })\n});", "example": "Zod"},
    {"id": "trc29", "type": "inference", "name": "Type Inference", "description": "Infer types", "pattern": "import type { inferRouterInputs, inferRouterOutputs } from '@trpc/server';\nimport type { AppRouter } from './server/routers/_app';\n\ntype RouterInput = inferRouterInputs<AppRouter>;\ntype RouterOutput = inferRouterOutputs<AppRouter>;\n\n// Use in components\ntype UserInput = RouterInput['createUser'];\ntype UserOutput = RouterOutput['getUser'];", "example": "Inference"},
    {"id": "trc30", "type": "pattern", "name": "Best Practices", "description": "Patterns", "pattern": "// 1. Use Zod for input validation\n// 2. Create separate routers per domain\n// 3. Use middleware for auth\n// 4. Enable superjson for rich types\n// 5. Prefetch data on hover", "example": "Patterns"}
  ]
}
