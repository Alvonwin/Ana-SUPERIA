{
  "category": "jwt-tokens-auth",
  "version": "1.0.0",
  "generatedBy": "Claude (Opus 4.5)",
  "description": "JWT token authentication patterns",
  "skills": [
    {"id": "jta01", "type": "setup", "name": "Install jsonwebtoken", "description": "NPM install", "pattern": "npm install jsonwebtoken\nnpm install @types/jsonwebtoken --save-dev", "example": "Install"},
    {"id": "jta02", "type": "sign", "name": "Sign Token", "description": "Create JWT", "pattern": "import jwt from 'jsonwebtoken';\n\nconst token = jwt.sign(\n  { userId: 123, role: 'admin' },\n  process.env.JWT_SECRET,\n  { expiresIn: '1h' }\n);", "example": "Sign"},
    {"id": "jta03", "type": "verify", "name": "Verify Token", "description": "Validate JWT", "pattern": "try {\n  const decoded = jwt.verify(token, process.env.JWT_SECRET);\n  console.log(decoded.userId);\n} catch (err) {\n  console.error('Invalid token');\n}", "example": "Verify"},
    {"id": "jta04", "type": "decode", "name": "Decode Token", "description": "Read payload", "pattern": "const decoded = jwt.decode(token);\nconst { header } = jwt.decode(token, { complete: true });", "example": "Decode"},
    {"id": "jta05", "type": "refresh", "name": "Refresh Tokens", "description": "Token rotation", "pattern": "const accessToken = jwt.sign({ userId }, SECRET, { expiresIn: '15m' });\nconst refreshToken = jwt.sign({ userId }, REFRESH_SECRET, { expiresIn: '7d' });", "example": "Refresh"},
    {"id": "jta06", "type": "middleware", "name": "Auth Middleware", "description": "Express middleware", "pattern": "function auth(req, res, next) {\n  const token = req.headers.authorization?.split(' ')[1];\n  if (!token) return res.status(401).json({ error: 'No token' });\n  try {\n    req.user = jwt.verify(token, SECRET);\n    next();\n  } catch {\n    res.status(401).json({ error: 'Invalid token' });\n  }\n}", "example": "Middleware"},
    {"id": "jta07", "type": "login", "name": "Login Flow", "description": "Authentication", "pattern": "app.post('/login', async (req, res) => {\n  const user = await verifyCredentials(req.body);\n  const token = jwt.sign({ userId: user.id }, SECRET, { expiresIn: '1h' });\n  res.json({ token });\n});", "example": "Login"},
    {"id": "jta08", "type": "cookie", "name": "HTTP-Only Cookie", "description": "Secure storage", "pattern": "res.cookie('token', accessToken, {\n  httpOnly: true,\n  secure: true,\n  sameSite: 'strict',\n  maxAge: 15 * 60 * 1000\n});", "example": "Cookie"},
    {"id": "jta09", "type": "claims", "name": "Custom Claims", "description": "Payload data", "pattern": "jwt.sign({\n  userId: user.id,\n  email: user.email,\n  role: user.role,\n  permissions: ['read', 'write'],\n  iss: 'my-app',\n  aud: 'my-api'\n}, SECRET);", "example": "Claims"},
    {"id": "jta10", "type": "role", "name": "Role Check", "description": "Authorization", "pattern": "function requireRole(...roles) {\n  return (req, res, next) => {\n    if (!roles.includes(req.user.role)) {\n      return res.status(403).json({ error: 'Forbidden' });\n    }\n    next();\n  };\n}", "example": "Roles"},
    {"id": "jta11", "type": "asymmetric", "name": "RS256", "description": "Public/private key", "pattern": "const token = jwt.sign(payload, privateKey, { algorithm: 'RS256' });\nconst decoded = jwt.verify(token, publicKey, { algorithms: ['RS256'] });", "example": "RS256"},
    {"id": "jta12", "type": "options", "name": "Sign Options", "description": "Token options", "pattern": "jwt.sign(payload, secret, {\n  expiresIn: '1h',\n  notBefore: '10s',\n  audience: 'my-api',\n  issuer: 'my-app',\n  subject: userId,\n  jwtid: uuid()\n});", "example": "Options"},
    {"id": "jta13", "type": "verify", "name": "Verify Options", "description": "Validation", "pattern": "jwt.verify(token, secret, {\n  algorithms: ['HS256'],\n  audience: 'my-api',\n  issuer: 'my-app',\n  clockTolerance: 30,\n  maxAge: '1h'\n});", "example": "Verify opts"},
    {"id": "jta14", "type": "blacklist", "name": "Token Blacklist", "description": "Revoke tokens", "pattern": "const blacklist = new Set();\n\napp.post('/logout', auth, (req, res) => {\n  blacklist.add(req.token);\n  res.json({ message: 'Logged out' });\n});", "example": "Blacklist"},
    {"id": "jta15", "type": "axios", "name": "Axios Interceptor", "description": "Auto-attach", "pattern": "api.interceptors.request.use((config) => {\n  const token = getToken();\n  if (token) config.headers.Authorization = `Bearer ${token}`;\n  return config;\n});", "example": "Axios"},
    {"id": "jta16", "type": "error", "name": "Error Types", "description": "Handle errors", "pattern": "if (err instanceof jwt.TokenExpiredError) { }\nif (err instanceof jwt.NotBeforeError) { }\nif (err instanceof jwt.JsonWebTokenError) { }", "example": "Errors"},
    {"id": "jta17", "type": "jose", "name": "jose Library", "description": "Modern API", "pattern": "import * as jose from 'jose';\n\nconst jwt = await new jose.SignJWT({ userId: 123 })\n  .setProtectedHeader({ alg: 'HS256' })\n  .setExpirationTime('1h')\n  .sign(secret);", "example": "jose"},
    {"id": "jta18", "type": "jwks", "name": "JWKS", "description": "Key rotation", "pattern": "import jwksClient from 'jwks-rsa';\n\nconst client = jwksClient({\n  jwksUri: 'https://auth.example.com/.well-known/jwks.json'\n});", "example": "JWKS"},
    {"id": "jta19", "type": "revoke", "name": "Redis Revocation", "description": "Scalable blacklist", "pattern": "async function revokeToken(token) {\n  const { exp } = jwt.decode(token);\n  const ttl = exp - Math.floor(Date.now() / 1000);\n  await redis.setex(`revoked:${token}`, ttl, '1');\n}", "example": "Redis"},
    {"id": "jta20", "type": "fingerprint", "name": "Token Fingerprint", "description": "Extra security", "pattern": "const fingerprint = crypto.randomBytes(32).toString('hex');\nconst hash = crypto.createHash('sha256').update(fingerprint).digest('hex');\nconst token = jwt.sign({ userId, fingerprint: hash }, SECRET);", "example": "Fingerprint"},
    {"id": "jta21", "type": "scope", "name": "Scopes", "description": "Permissions", "pattern": "const token = jwt.sign({ userId, scope: 'read:users write:posts' }, SECRET);\n\nfunction requireScope(scope) {\n  return (req, res, next) => {\n    const scopes = req.user.scope?.split(' ') || [];\n    if (!scopes.includes(scope)) return res.status(403).end();\n    next();\n  };\n}", "example": "Scopes"},
    {"id": "jta22", "type": "structure", "name": "JWT Structure", "description": "Token format", "pattern": "// header.payload.signature\n// $2b$10$...\n// Header: { alg: 'HS256', typ: 'JWT' }\n// Payload: { userId, iat, exp }\n// Signature: HMAC(header.payload, secret)", "example": "Structure"},
    {"id": "jta23", "type": "next", "name": "Next.js Auth", "description": "NextAuth JWT", "pattern": "export default NextAuth({\n  session: { strategy: 'jwt' },\n  callbacks: {\n    async jwt({ token, user }) {\n      if (user) token.role = user.role;\n      return token;\n    }\n  }\n});", "example": "Next.js"},
    {"id": "jta24", "type": "express", "name": "express-jwt", "description": "Middleware lib", "pattern": "import { expressjwt } from 'express-jwt';\n\napp.use('/api', expressjwt({\n  secret: SECRET,\n  algorithms: ['HS256']\n}));", "example": "express-jwt"},
    {"id": "jta25", "type": "typescript", "name": "TypeScript", "description": "Types", "pattern": "interface JwtPayload {\n  userId: number;\n  role: 'admin' | 'user';\n  iat: number;\n  exp: number;\n}\n\nconst decoded = jwt.verify(token, SECRET) as JwtPayload;", "example": "TypeScript"},
    {"id": "jta26", "type": "test", "name": "Testing", "description": "Test JWT", "pattern": "test('verifies valid token', () => {\n  const token = jwt.sign({ userId: 1 }, 'secret');\n  const decoded = jwt.verify(token, 'secret');\n  expect(decoded.userId).toBe(1);\n});", "example": "Testing"},
    {"id": "jta27", "type": "security", "name": "Security Tips", "description": "Best practices", "pattern": "// 1. Strong secrets (256+ bits)\n// 2. Short expiry (15-30 min)\n// 3. httpOnly cookies\n// 4. HTTPS only\n// 5. Validate all claims\n// 6. Token rotation", "example": "Security"},
    {"id": "jta28", "type": "client", "name": "Client Storage", "description": "Frontend", "pattern": "// Memory (most secure for SPAs)\nlet accessToken = null;\n\n// Attach to requests\nfetch('/api', {\n  headers: { 'Authorization': `Bearer ${accessToken}` }\n});", "example": "Client"},
    {"id": "jta29", "type": "refresh", "name": "Refresh Endpoint", "description": "Get new token", "pattern": "app.post('/refresh', async (req, res) => {\n  const { refreshToken } = req.body;\n  const decoded = jwt.verify(refreshToken, REFRESH_SECRET);\n  const accessToken = jwt.sign({ userId: decoded.userId }, SECRET, { expiresIn: '15m' });\n  res.json({ accessToken });\n});", "example": "Refresh API"},
    {"id": "jta30", "type": "flow", "name": "Complete Flow", "description": "Auth flow", "pattern": "// 1. Login -> Access + Refresh\n// 2. Access: short-lived, contains claims\n// 3. Refresh: long-lived, stored securely\n// 4. On 401 -> Use refresh\n// 5. On logout -> Revoke refresh", "example": "Flow"}
  ]
}
