{
  "category": "passport-authentication",
  "version": "1.0.0",
  "generatedBy": "Claude (Opus 4.5)",
  "description": "Passport.js authentication patterns",
  "skills": [
    {"id": "pas01", "type": "setup", "name": "Install Passport", "description": "NPM install", "pattern": "npm install passport passport-local express-session\nnpm install @types/passport @types/passport-local --save-dev", "example": "Install"},
    {"id": "pas02", "type": "init", "name": "Initialize", "description": "Setup Passport", "pattern": "import express from 'express';\nimport session from 'express-session';\nimport passport from 'passport';\n\nconst app = express();\n\napp.use(session({\n  secret: 'your-secret',\n  resave: false,\n  saveUninitialized: false\n}));\n\napp.use(passport.initialize());\napp.use(passport.session());", "example": "Init"},
    {"id": "pas03", "type": "local", "name": "Local Strategy", "description": "Username/password", "pattern": "import { Strategy as LocalStrategy } from 'passport-local';\n\npassport.use(new LocalStrategy(async (username, password, done) => {\n  try {\n    const user = await User.findOne({ username });\n    if (!user) return done(null, false, { message: 'User not found' });\n    \n    const isValid = await bcrypt.compare(password, user.password);\n    if (!isValid) return done(null, false, { message: 'Invalid password' });\n    \n    return done(null, user);\n  } catch (err) {\n    return done(err);\n  }\n}));", "example": "Local"},
    {"id": "pas04", "type": "serialize", "name": "Serialize User", "description": "Session handling", "pattern": "passport.serializeUser((user, done) => {\n  done(null, user.id);\n});\n\npassport.deserializeUser(async (id, done) => {\n  try {\n    const user = await User.findById(id);\n    done(null, user);\n  } catch (err) {\n    done(err);\n  }\n});", "example": "Serialize"},
    {"id": "pas05", "type": "login", "name": "Login Route", "description": "Authenticate user", "pattern": "app.post('/login', \n  passport.authenticate('local', {\n    successRedirect: '/dashboard',\n    failureRedirect: '/login',\n    failureFlash: true\n  })\n);\n\n// Or with custom callback\napp.post('/login', (req, res, next) => {\n  passport.authenticate('local', (err, user, info) => {\n    if (err) return next(err);\n    if (!user) return res.status(401).json(info);\n    \n    req.logIn(user, (err) => {\n      if (err) return next(err);\n      return res.json({ success: true, user });\n    });\n  })(req, res, next);\n});", "example": "Login"},
    {"id": "pas06", "type": "logout", "name": "Logout", "description": "End session", "pattern": "app.post('/logout', (req, res, next) => {\n  req.logout((err) => {\n    if (err) return next(err);\n    res.redirect('/login');\n  });\n});", "example": "Logout"},
    {"id": "pas07", "type": "protect", "name": "Protected Routes", "description": "Auth middleware", "pattern": "function ensureAuthenticated(req, res, next) {\n  if (req.isAuthenticated()) {\n    return next();\n  }\n  res.redirect('/login');\n}\n\n// Use on routes\napp.get('/dashboard', ensureAuthenticated, (req, res) => {\n  res.render('dashboard', { user: req.user });\n});", "example": "Protect"},
    {"id": "pas08", "type": "google", "name": "Google OAuth", "description": "Google strategy", "pattern": "import { Strategy as GoogleStrategy } from 'passport-google-oauth20';\n\npassport.use(new GoogleStrategy({\n  clientID: process.env.GOOGLE_CLIENT_ID,\n  clientSecret: process.env.GOOGLE_CLIENT_SECRET,\n  callbackURL: '/auth/google/callback'\n}, async (accessToken, refreshToken, profile, done) => {\n  try {\n    let user = await User.findOne({ googleId: profile.id });\n    if (!user) {\n      user = await User.create({\n        googleId: profile.id,\n        email: profile.emails[0].value,\n        name: profile.displayName\n      });\n    }\n    return done(null, user);\n  } catch (err) {\n    return done(err);\n  }\n}));", "example": "Google"},
    {"id": "pas09", "type": "googleroutes", "name": "Google Routes", "description": "OAuth routes", "pattern": "app.get('/auth/google',\n  passport.authenticate('google', { scope: ['profile', 'email'] })\n);\n\napp.get('/auth/google/callback',\n  passport.authenticate('google', { failureRedirect: '/login' }),\n  (req, res) => {\n    res.redirect('/dashboard');\n  }\n);", "example": "Google Routes"},
    {"id": "pas10", "type": "github", "name": "GitHub OAuth", "description": "GitHub strategy", "pattern": "import { Strategy as GitHubStrategy } from 'passport-github2';\n\npassport.use(new GitHubStrategy({\n  clientID: process.env.GITHUB_CLIENT_ID,\n  clientSecret: process.env.GITHUB_CLIENT_SECRET,\n  callbackURL: '/auth/github/callback'\n}, async (accessToken, refreshToken, profile, done) => {\n  let user = await User.findOrCreate({ githubId: profile.id });\n  return done(null, user);\n}));", "example": "GitHub"},
    {"id": "pas11", "type": "jwt", "name": "JWT Strategy", "description": "Token auth", "pattern": "import { Strategy as JwtStrategy, ExtractJwt } from 'passport-jwt';\n\npassport.use(new JwtStrategy({\n  jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),\n  secretOrKey: process.env.JWT_SECRET\n}, async (payload, done) => {\n  try {\n    const user = await User.findById(payload.sub);\n    if (!user) return done(null, false);\n    return done(null, user);\n  } catch (err) {\n    return done(err);\n  }\n}));", "example": "JWT"},
    {"id": "pas12", "type": "jwtauth", "name": "JWT Routes", "description": "Token endpoints", "pattern": "import jwt from 'jsonwebtoken';\n\napp.post('/api/login', async (req, res) => {\n  const { email, password } = req.body;\n  const user = await User.findOne({ email });\n  \n  if (!user || !await bcrypt.compare(password, user.password)) {\n    return res.status(401).json({ error: 'Invalid credentials' });\n  }\n  \n  const token = jwt.sign({ sub: user.id }, process.env.JWT_SECRET, {\n    expiresIn: '7d'\n  });\n  \n  res.json({ token });\n});\n\napp.get('/api/profile',\n  passport.authenticate('jwt', { session: false }),\n  (req, res) => res.json(req.user)\n);", "example": "JWT Auth"},
    {"id": "pas13", "type": "facebook", "name": "Facebook Strategy", "description": "Facebook login", "pattern": "import { Strategy as FacebookStrategy } from 'passport-facebook';\n\npassport.use(new FacebookStrategy({\n  clientID: process.env.FACEBOOK_APP_ID,\n  clientSecret: process.env.FACEBOOK_APP_SECRET,\n  callbackURL: '/auth/facebook/callback',\n  profileFields: ['id', 'emails', 'name']\n}, async (accessToken, refreshToken, profile, done) => {\n  let user = await User.findOrCreate({ facebookId: profile.id });\n  return done(null, user);\n}));", "example": "Facebook"},
    {"id": "pas14", "type": "twitter", "name": "Twitter Strategy", "description": "Twitter login", "pattern": "import { Strategy as TwitterStrategy } from 'passport-twitter';\n\npassport.use(new TwitterStrategy({\n  consumerKey: process.env.TWITTER_CONSUMER_KEY,\n  consumerSecret: process.env.TWITTER_CONSUMER_SECRET,\n  callbackURL: '/auth/twitter/callback'\n}, async (token, tokenSecret, profile, done) => {\n  let user = await User.findOrCreate({ twitterId: profile.id });\n  return done(null, user);\n}));", "example": "Twitter"},
    {"id": "pas15", "type": "fields", "name": "Custom Fields", "description": "Change field names", "pattern": "passport.use(new LocalStrategy({\n  usernameField: 'email',\n  passwordField: 'password',\n  passReqToCallback: true\n}, async (req, email, password, done) => {\n  // Access req object here\n  const user = await User.findOne({ email });\n  // ...\n}));", "example": "Fields"},
    {"id": "pas16", "type": "multiple", "name": "Multiple Strategies", "description": "Combine strategies", "pattern": "// Use specific strategy\napp.post('/login', passport.authenticate('local'));\napp.get('/auth/google', passport.authenticate('google'));\n\n// Or try multiple\napp.post('/api/login', (req, res, next) => {\n  passport.authenticate(['local', 'jwt'], (err, user) => {\n    // Handle authentication\n  })(req, res, next);\n});", "example": "Multiple"},
    {"id": "pas17", "type": "flash", "name": "Flash Messages", "description": "Error messages", "pattern": "import flash from 'connect-flash';\n\napp.use(flash());\n\napp.post('/login',\n  passport.authenticate('local', {\n    failureRedirect: '/login',\n    failureFlash: true\n  })\n);\n\napp.get('/login', (req, res) => {\n  res.render('login', { message: req.flash('error') });\n});", "example": "Flash"},
    {"id": "pas18", "type": "role", "name": "Role-Based Access", "description": "Authorization", "pattern": "function authorize(...roles) {\n  return (req, res, next) => {\n    if (!req.isAuthenticated()) {\n      return res.status(401).json({ error: 'Not authenticated' });\n    }\n    if (!roles.includes(req.user.role)) {\n      return res.status(403).json({ error: 'Forbidden' });\n    }\n    next();\n  };\n}\n\napp.get('/admin', authorize('admin'), adminController);", "example": "Role"},
    {"id": "pas19", "type": "remember", "name": "Remember Me", "description": "Persistent login", "pattern": "app.post('/login', (req, res, next) => {\n  passport.authenticate('local', (err, user) => {\n    req.logIn(user, (err) => {\n      if (req.body.remember) {\n        req.session.cookie.maxAge = 30 * 24 * 60 * 60 * 1000; // 30 days\n      } else {\n        req.session.cookie.expires = false; // Session cookie\n      }\n      res.redirect('/dashboard');\n    });\n  })(req, res, next);\n});", "example": "Remember"},
    {"id": "pas20", "type": "api", "name": "API Key Strategy", "description": "API authentication", "pattern": "import { Strategy as ApiKeyStrategy } from 'passport-headerapikey';\n\npassport.use(new ApiKeyStrategy(\n  { header: 'X-API-KEY' },\n  async (apiKey, done) => {\n    const client = await ApiClient.findOne({ apiKey });\n    if (!client) return done(null, false);\n    return done(null, client);\n  }\n));", "example": "API Key"},
    {"id": "pas21", "type": "bearer", "name": "Bearer Token", "description": "Bearer strategy", "pattern": "import { Strategy as BearerStrategy } from 'passport-http-bearer';\n\npassport.use(new BearerStrategy(async (token, done) => {\n  try {\n    const user = await User.findOne({ accessToken: token });\n    if (!user) return done(null, false);\n    return done(null, user);\n  } catch (err) {\n    return done(err);\n  }\n}));", "example": "Bearer"},
    {"id": "pas22", "type": "saml", "name": "SAML Strategy", "description": "Enterprise SSO", "pattern": "import { Strategy as SamlStrategy } from 'passport-saml';\n\npassport.use(new SamlStrategy({\n  entryPoint: 'https://idp.example.com/sso',\n  issuer: 'my-app',\n  cert: fs.readFileSync('./idp-cert.pem', 'utf-8')\n}, async (profile, done) => {\n  const user = await User.findOrCreate({ samlId: profile.nameID });\n  return done(null, user);\n}));", "example": "SAML"},
    {"id": "pas23", "type": "link", "name": "Account Linking", "description": "Link providers", "pattern": "app.get('/connect/google',\n  passport.authorize('google', { scope: ['profile'] })\n);\n\n// Use authorize() instead of authenticate() to link accounts\npassport.use('google', new GoogleStrategy({\n  passReqToCallback: true\n}, (req, accessToken, refreshToken, profile, done) => {\n  if (req.user) {\n    // Link to existing account\n    req.user.googleId = profile.id;\n    await req.user.save();\n    return done(null, req.user);\n  }\n  // Normal authentication\n}));", "example": "Link"},
    {"id": "pas24", "type": "refresh", "name": "Refresh Token", "description": "Token refresh", "pattern": "passport.use(new GoogleStrategy({\n  // ...\n}, async (accessToken, refreshToken, profile, done) => {\n  const user = await User.findOne({ googleId: profile.id });\n  \n  // Store tokens for later use\n  user.googleAccessToken = accessToken;\n  user.googleRefreshToken = refreshToken;\n  await user.save();\n  \n  return done(null, user);\n}));", "example": "Refresh"},
    {"id": "pas25", "type": "scope", "name": "OAuth Scopes", "description": "Permission scopes", "pattern": "app.get('/auth/google',\n  passport.authenticate('google', {\n    scope: [\n      'profile',\n      'email',\n      'https://www.googleapis.com/auth/calendar.readonly'\n    ],\n    accessType: 'offline',\n    prompt: 'consent'\n  })\n);", "example": "Scope"},
    {"id": "pas26", "type": "state", "name": "State Parameter", "description": "CSRF protection", "pattern": "app.get('/auth/google',\n  (req, res, next) => {\n    req.session.returnTo = req.query.returnTo || '/dashboard';\n    next();\n  },\n  passport.authenticate('google', {\n    state: true  // Enables state parameter\n  })\n);\n\napp.get('/auth/google/callback',\n  passport.authenticate('google'),\n  (req, res) => {\n    res.redirect(req.session.returnTo || '/dashboard');\n  }\n);", "example": "State"},
    {"id": "pas27", "type": "typescript", "name": "TypeScript", "description": "Type safety", "pattern": "import { Request } from 'express';\nimport { User } from './models/User';\n\ndeclare global {\n  namespace Express {\n    interface User {\n      id: string;\n      email: string;\n      role: 'user' | 'admin';\n    }\n  }\n}\n\nconst ensureAuth = (req: Request, res, next) => {\n  if (req.isAuthenticated()) {\n    const user: Express.User = req.user!;\n    return next();\n  }\n};", "example": "TypeScript"},
    {"id": "pas28", "type": "test", "name": "Testing", "description": "Test auth", "pattern": "import request from 'supertest';\n\ndescribe('Authentication', () => {\n  it('should login successfully', async () => {\n    const res = await request(app)\n      .post('/login')\n      .send({ username: 'test', password: 'test123' })\n      .expect(302);\n    \n    expect(res.headers.location).toBe('/dashboard');\n  });\n});", "example": "Testing"},
    {"id": "pas29", "type": "error", "name": "Error Handling", "description": "Handle auth errors", "pattern": "app.post('/login', (req, res, next) => {\n  passport.authenticate('local', (err, user, info) => {\n    if (err) {\n      return res.status(500).json({ error: 'Server error' });\n    }\n    if (!user) {\n      return res.status(401).json({ \n        error: info?.message || 'Authentication failed' \n      });\n    }\n    req.logIn(user, (err) => {\n      if (err) return next(err);\n      return res.json({ success: true });\n    });\n  })(req, res, next);\n});", "example": "Error"},
    {"id": "pas30", "type": "pattern", "name": "Best Practices", "description": "Patterns", "pattern": "// 1. Always hash passwords with bcrypt\n// 2. Use session store (Redis) in production\n// 3. Implement rate limiting on login\n// 4. Use HTTPS in production\n// 5. Validate redirect URLs to prevent open redirects", "example": "Patterns"}
  ]
}
